<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026è·¨å¹´ç¥ç¦è¯­ç§»åŠ¨æ•ˆæœç½‘é¡µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        #countdown {
            font-size: 12rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            color: #FFD700;
            transition: all 0.3s ease;
        }

        .countdown-pulse {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            50% { transform: scale(1.1); text-shadow: 0 0 30px rgba(255, 215, 0, 1); }
            100% { transform: scale(1); text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        #message {
            font-size: 2rem;
            margin-bottom: 3rem;
            text-align: center;
            max-width: 80%;
            opacity: 0;
            transform: translateY(30px);
            transition: all 1s ease-out;
        }

        .show {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        #toast-area {
            position: relative;
            margin: 2rem 0;
            opacity: 0;
            transform: translateY(30px);
            transition: all 1s ease-out 0.5s;
        }

        #toast-area.show {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        .glass {
            font-size: 6rem;
            cursor: pointer;
            transition: transform 0.3s ease;
            user-select: none;
        }

        .glass:hover {
            transform: scale(1.1);
        }

        .glass:active {
            transform: scale(0.9);
        }

        #toast-animation {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            opacity: 0;
            pointer-events: none;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .controls {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            opacity: 0;
            transform: translateY(30px);
            transition: all 1s ease-out 0.5s;
        }

        .controls.show {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 215, 0, 0.5);
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        button:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .year-display {
            font-size: 6rem;
            margin: 2rem 0;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .year-display.show {
            opacity: 1;
        }

        /* èƒŒæ™¯ç¥ç¦æ–‡å­— */
        .background-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            font-weight: bold;
            color: rgba(255, 215, 0, 0.1);
            z-index: 1;
            pointer-events: none;
            white-space: nowrap;
        }

        /* ç¥ç¦è¯­æ ·å¼ */
        .blessing {
            position: absolute;
            font-size: 2.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 1);
            padding: 12px 24px;
            border-radius: 30px;
            background: rgba(0, 0, 0, 0.4);
            pointer-events: none;
            z-index: 100;
            white-space: nowrap;
        }

        /* å…¥åœºåŠ¨ç”» - å¤šç§æƒŠå–œæ•ˆæœ */
        .blessing-enter {
            animation: surpriseScale 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes surpriseScale {
            0% { 
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
            70% {
                transform: scale(1.2) rotate(5deg);
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* å‡ºåœºåŠ¨ç”» - å‡ºå…¶ä¸æ„ */
        .blessing-exit {
            animation: surpriseExit 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes surpriseExit {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            30% {
                transform: scale(1.1) rotate(10deg) translateY(-20px);
                opacity: 0.8;
            }
            60% {
                transform: scale(0.8) rotate(-20deg) translateY(30px) translateX(20px);
                opacity: 0.5;
            }
            100% { 
                transform: scale(0) rotate(360deg) translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .music-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.5);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .music-btn:hover {
            background: rgba(255, 215, 0, 0.5);
            transform: scale(1.1);
        }

        .music-btn.active {
            background: rgba(255, 215, 0, 0.7);
        }
    </style>
</head>
<body>
    <div id="countdown">10</div>
    <div class="year-display" id="yearDisplay">2026!</div>
    <div id="message">æ–°å¹´å¿«ä¹ï¼æ„¿ä½ å¹³å®‰å–œä¹ï¼Œé—ªé—ªå‘å…‰âœ¨</div>
    <div id="toast-area">
        <div class="glass" id="glass1">ğŸ¥‚</div>
        <div id="toast-animation" id="toastAnim">ğŸ¥‚</div>
    </div>
    <div class="controls">
        <button id="toastBtn">ç‚¹å‡»ç¢°æ¯</button>
        <button id="restartBtn">é‡æ–°å¼€å§‹</button>
    </div>

    <canvas id="fireworks"></canvas>

    <!-- éŸ³æ•ˆ -->
    <audio id="clinkSound" preload="auto">
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" type="audio/mpeg">
    </audio>
    <audio id="cheerSound" preload="auto">
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" type="audio/mpeg">
    </audio>
    
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop>
        <source src="T:\Hbuilder\ä½œä¸šç•™å­˜\2026ç¥ç¦è¯­\ç¥ç¦ä½ .mp4" type="audio/mpeg">
    </audio>

    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-controls">
        <button class="music-btn" id="musicPlayBtn">â–¶</button>
        <button class="music-btn" id="musicPauseBtn">â¸</button>
        <button class="music-btn" id="musicMuteBtn">ğŸ”Š</button>
    </div>

    <script>
        // çƒŸèŠ±ç²’å­ç³»ç»Ÿ
        class Fireworks {
            constructor() {
                this.canvas = document.getElementById('fireworks');
                if (!this.canvas) {
                    console.error('Canvas element not found');
                    return;
                }
                
                this.ctx = this.canvas.getContext('2d');
                if (!this.ctx) {
                    console.error('Canvas context not available');
                    return;
                }
                
                this.particles = [];
                this.colors = ['#ff0055', '#00ccff', '#ffff00', '#ff6600', '#00ff99', '#ff00ff'];
                
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                this.animate();
            }

            resizeCanvas() {
                if (this.canvas) {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                }
            }

            createParticle(x, y, color) {
                const particle = {
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    radius: Math.random() * 2 + 1,
                    color: color,
                    life: 100
                };
                this.particles.push(particle);
            }

            update() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1; // é‡åŠ›
                    p.life--;
                    
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }

            draw() {
                if (this.ctx) {
                    this.ctx.fillStyle = 'rgba(15, 12, 41, 0.1)';
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                    
                    this.particles.forEach(p => {
                        this.ctx.globalAlpha = p.life / 100;
                        this.ctx.fillStyle = p.color;
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        this.ctx.fill();
                    });
                    this.ctx.globalAlpha = 1;
                }
            }

            launch(x, y) {
                const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                for (let i = 0; i < 50; i++) {
                    this.createParticle(x || Math.random() * this.canvas.width, 
                                      y || Math.random() * this.canvas.height * 0.3, 
                                      color);
                }
            }

            animate() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }

        // åˆå§‹åŒ–çƒŸèŠ±
        const fireworks = new Fireworks();

        // è·å–DOMå…ƒç´ çš„å‡½æ•°
        function getElement(id) {
            return document.getElementById(id);
        }

        // ç¥ç¦è¯­æ•°ç»„ï¼ˆ34ä¸ªï¼‰
        const blessings = [
            "äº‹äº‹é¡ºæ„", "å¿«ä¹æ— å¿§", "èº«ä½“å¥åº·", "å‡ºå…¥å¹³å®‰", "è´¢æºå¹¿è¿›", 
            "å­¦ä¸šè¿›æ­¥", "å·¥ä½œé¡ºåˆ©", "çˆ±æƒ…ç”œèœœ", "å®¶åº­å’Œç¦", "ç¦æ˜Ÿé«˜ç…§",
            "å‰ç¥¥å¦‚æ„", "å¿ƒæƒ³äº‹æˆ", "ä¸‡äº‹å¦‚æ„", "æ­¥æ­¥é«˜å‡", "ç¬‘å£å¸¸å¼€",
            "å¥½è¿è¿è¿", "å¹¸ç¦ç¾æ»¡", "é’æ˜¥æ°¸é©»", "æ™ºæ…§å¦‚æµ·", "å‹è°Šé•¿å­˜",
            "å¹³å®‰å–œä¹", "å‰ç¨‹ä¼¼é”¦", "é‡‘ç‰æ»¡å ‚", "å¯Œè´µæ»¡å ‚", "é¾™é©¬ç²¾ç¥",
            "ç²¾ç¥ç„•å‘", "è´¢æºæ»šæ»š", "æ—¥è¿›æ–—é‡‘", "é¸¿è¿å½“å¤´", "ç¦å¯¿å®‰åº·",
            "å¿ƒæƒ³äº‹æˆ", "ä¸‡äº‹å¦‚æ„", "å¹¸ç¦ç¾æ»¡", "å¥åº·é•¿å¯¿"
        ];

        // æ£€æŸ¥é‡å çš„å‡½æ•°
        function isOverlapping(newRect, existingRects) {
            for (let rect of existingRects) {
                if (
                    newRect.left < rect.right &&
                    newRect.right > rect.left &&
                    newRect.top < rect.bottom &&
                    newRect.bottom > rect.top
                ) {
                    return true;
                }
            }
            return false;
        }

        // åˆ›å»ºèƒŒæ™¯æ–‡å­—
        function createBackgroundText() {
            const bgText = document.createElement('div');
            bgText.className = 'background-text';
            bgText.textContent = 'æˆ‘ç¥ä½ ä»Šå¹´ä¼š';
            document.body.appendChild(bgText);
        }

        // æ£€æŸ¥é¡µé¢ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
        function hasSpaceForBlessings() {
            const totalBlessings = document.querySelectorAll('.blessing').length;
            const availableArea = window.innerWidth * window.innerHeight;
            const avgBlessingArea = 200 * 80; // ä¼°ç®—æ¯ä¸ªç¥ç¦è¯­çš„å¹³å‡é¢ç§¯
            const maxBlessings = Math.floor(availableArea / avgBlessingArea * 0.7); // 70%çš„ç©ºé—´åˆ©ç”¨ç‡
            
            return totalBlessings < maxBlessings && totalBlessings < 34; // é™åˆ¶æ€»æ•°ä¸è¶…è¿‡34
        }

        // æ˜¾ç¤ºéšæœºç¥ç¦è¯­ç»„
        function showRandomBlessings() {
            // æ¸…é™¤ç°æœ‰çš„ç¥ç¦è¯­
            document.querySelectorAll('.blessing').forEach(el => el.remove());
            
            // ç§»é™¤2026å’Œæ–°å¹´å¿«ä¹æ–‡å­—
            const yearDisplay = getElement('yearDisplay');
            const message = getElement('message');
            if (yearDisplay) yearDisplay.style.display = 'none';
            if (message) message.style.display = 'none';
            
            // åˆ›å»ºèƒŒæ™¯æ–‡å­—
            createBackgroundText();
            
            // åˆ†3ç»„æ˜¾ç¤ºç¥ç¦è¯­ï¼ˆæ€»å…±ä¸è¶…è¿‡34ä¸ªï¼‰
            const totalGroups = 3;
            const itemsPerGroup = 11; // æ¯ç»„11ä¸ªç¥ç¦è¯­ (11*3=33 < 34)
            
            for (let group = 0; group < totalGroups; group++) {
                setTimeout(() => {
                    const existingRects = []; // å­˜å‚¨å½“å‰ç»„çš„å·²æ”¾ç½®åŒºåŸŸ
                    const currentGroup = []; // å­˜å‚¨å½“å‰ç»„çš„ç¥ç¦è¯­å…ƒç´ 
                    
                    for (let i = 0; i < itemsPerGroup; i++) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—´ç»§ç»­ç”Ÿæˆ
                        if (!hasSpaceForBlessings()) {
                            console.log('ç©ºé—´ä¸è¶³æˆ–å·²è¾¾åˆ°ä¸Šé™ï¼Œåœæ­¢ç”Ÿæˆç¥ç¦è¯­');
                            break;
                        }
                        
                        setTimeout(() => {
                            // å†æ¬¡æ£€æŸ¥ç©ºé—´
                            if (!hasSpaceForBlessings()) {
                                return;
                            }
                            
                            const randomBlessing = blessings[Math.floor(Math.random() * blessings.length)];
                            const blessingEl = document.createElement('div');
                            blessingEl.className = 'blessing blessing-enter';
                            blessingEl.textContent = randomBlessing;
                            
                            // ä¸´æ—¶æ·»åŠ åˆ°DOMä»¥è·å–å°ºå¯¸
                            document.body.appendChild(blessingEl);
                            
                            // å°è¯•æ‰¾åˆ°ä¸é‡å çš„ä½ç½®
                            let attempts = 0;
                            let positionFound = false;
                            
                            while (attempts < 50 && !positionFound) {
                                // éšæœºä½ç½®ï¼Œè€ƒè™‘å…ƒç´ å°ºå¯¸
                                const maxX = window.innerWidth - blessingEl.offsetWidth;
                                const maxY = window.innerHeight - blessingEl.offsetHeight;
                                const posX = Math.floor(Math.random() * maxX);
                                const posY = Math.floor(Math.random() * maxY);
                                
                                // è®¾ç½®ä½ç½®
                                blessingEl.style.left = `${posX}px`;
                                blessingEl.style.top = `${posY}px`;
                                
                                // è·å–å…ƒç´ çŸ©å½¢
                                const rect = {
                                    left: posX,
                                    top: posY,
                                    right: posX + blessingEl.offsetWidth,
                                    bottom: posY + blessingEl.offsetHeight
                                };
                                
                                // æ£€æŸ¥æ˜¯å¦ä¸ç°æœ‰å…ƒç´ é‡å 
                                if (!isOverlapping(rect, existingRects)) {
                                    existingRects.push(rect);
                                    positionFound = true;
                                }
                                
                                attempts++;
                            }
                            
                            // å¦‚æœæ— æ³•æ‰¾åˆ°ä¸é‡å çš„ä½ç½®ï¼Œä½¿ç”¨éšæœºä½ç½®
                            if (!positionFound) {
                                const maxX = window.innerWidth - blessingEl.offsetWidth;
                                const maxY = window.innerHeight - blessingEl.offsetHeight;
                                const posX = Math.floor(Math.random() * maxX);
                                const posY = Math.floor(Math.random() * maxY);
                                
                                blessingEl.style.left = `${posX}px`;
                                blessingEl.style.top = `${posY}px`;
                                
                                existingRects.push({
                                    left: posX,
                                    top: posY,
                                    right: posX + blessingEl.offsetWidth,
                                    bottom: posY + blessingEl.offsetHeight
                                });
                            }
                            
                            // éšæœºé¢œè‰²
                            const colors = [
                                '#FFD700', '#FF69B4', '#00FFFF', '#FF6347', 
                                '#7CFC00', '#9370DB', '#FFA500', '#FF1493', 
                                '#00FA9A', '#8A2BE2', '#FF4500', '#ADFF2F'
                            ];
                            const randomColor = colors[Math.floor(Math.random() * colors.length)];
                            blessingEl.style.color = randomColor;
                            blessingEl.style.textShadow = `0 0 15px ${randomColor}80`;
                            
                            // éšæœºæ—‹è½¬è§’åº¦
                            const randomRotation = Math.floor(Math.random() * 20) - 10; // -10åˆ°10åº¦
                            blessingEl.style.transform = `rotate(${randomRotation}deg)`;
                            
                            // å¦‚æœä½ç½®è¢«å¼ºåˆ¶è®¾ç½®ï¼Œé‡æ–°æ·»åŠ åˆ°DOM
                            if (blessingEl.parentNode) {
                                // ä¿æŒåœ¨DOMä¸­
                            } else {
                                document.body.appendChild(blessingEl);
                            }
                            
                            // æ·»åŠ åˆ°å½“å‰ç»„
                            currentGroup.push(blessingEl);
                            
                            // 35ç§’åå¼€å§‹æ·¡å‡º
                            setTimeout(() => {
                                blessingEl.classList.remove('blessing-enter');
                                blessingEl.classList.add('blessing-exit');
                                
                                // 1ç§’åç§»é™¤å…ƒç´ 
                                setTimeout(() => {
                                    if (blessingEl.parentNode) {
                                        blessingEl.parentNode.removeChild(blessingEl);
                                    }
                                }, 1000);
                                
                                // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç»„æœ€åä¸€ä¸ªå…ƒç´ 
                                if (currentGroup.every(el => !el.parentNode)) {
                                    // å½“å‰ç»„å…¨éƒ¨æ¶ˆå¤±åï¼Œç­‰å¾…2ç§’è¡¥å……ä¸‹ä¸€ç»„
                                    if (group < totalGroups - 1) {
                                        setTimeout(() => {
                                            showNextGroup(group + 1, itemsPerGroup);
                                        }, 2000);
                                    }
                                }
                            }, 35000); // 35ç§’åœç•™
                            
                            // æ·»åŠ ç§»åŠ¨åŠ¨ç”»ï¼ˆæ— ç¢°æ’ï¼‰
                            startMovingAnimation(blessingEl);
                        }, i * 150); // ç»„å†…é”™å¼€æ˜¾ç¤ºæ—¶é—´
                    }
                }, group === 0 ? 0 : 2000); // ç¬¬ä¸€ç»„ç«‹å³æ˜¾ç¤ºï¼Œåç»­ç»„é—´éš”2ç§’
            }
        }

        // ç§»åŠ¨åŠ¨ç”»å‡½æ•°ï¼ˆæ— ç¢°æ’æ£€æµ‹ï¼‰
        function startMovingAnimation(blessingEl) {
            let vx = (Math.random() - 0.5) * 2; // æ°´å¹³é€Ÿåº¦
            let vy = (Math.random() - 0.5) * 2; // å‚ç›´é€Ÿåº¦
            
            // ç§»åŠ¨å‡½æ•°
            function move() {
                if (!blessingEl.parentNode) return; // å¦‚æœå…ƒç´ å·²ç§»é™¤åˆ™åœæ­¢
                
                // è·å–å½“å‰ä½ç½®
                let x = parseFloat(blessingEl.style.left) || 0;
                let y = parseFloat(blessingEl.style.top) || 0;
                
                // æ›´æ–°ä½ç½®
                x += vx;
                y += vy;
                
                // è¾¹ç•Œæ£€æµ‹ - åå¼¹
                const maxX = window.innerWidth - blessingEl.offsetWidth;
                const maxY = window.innerHeight - blessingEl.offsetHeight;
                
                if (x <= 0) {
                    x = 0;
                    vx = -vx * 0.8; // åå¼¹å¹¶å‡å°‘é€Ÿåº¦
                } else if (x >= maxX) {
                    x = maxX;
                    vx = -vx * 0.8;
                }
                
                if (y <= 0) {
                    y = 0;
                    vy = -vy * 0.8;
                } else if (y >= maxY) {
                    y = maxY;
                    vy = -vy * 0.8;
                }
                
                // è®¾ç½®æ–°ä½ç½®
                blessingEl.style.left = `${x}px`;
                blessingEl.style.top = `${y}px`;
                
                // ç»§ç»­åŠ¨ç”»
                requestAnimationFrame(move);
            }
            
            // å¼€å§‹ç§»åŠ¨
            move();
        }

        // æ˜¾ç¤ºä¸‹ä¸€ç»„ç¥ç¦è¯­
        function showNextGroup(groupIndex, itemsPerGroup) {
            const existingRects = []; // å­˜å‚¨å½“å‰ç»„çš„å·²æ”¾ç½®åŒºåŸŸ
            const currentGroup = []; // å­˜å‚¨å½“å‰ç»„çš„ç¥ç¦è¯­å…ƒç´ 
            
            for (let i = 0; i < itemsPerGroup; i++) {
                // æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—´ç»§ç»­ç”Ÿæˆ
                if (!hasSpaceForBlessings()) {
                    console.log('ç©ºé—´ä¸è¶³æˆ–å·²è¾¾åˆ°ä¸Šé™ï¼Œåœæ­¢ç”Ÿæˆç¥ç¦è¯­');
                    break;
                }
                
                setTimeout(() => {
                    // å†æ¬¡æ£€æŸ¥ç©ºé—´
                    if (!hasSpaceForBlessings()) {
                        return;
                    }
                    
                    const randomBlessing = blessings[Math.floor(Math.random() * blessings.length)];
                    const blessingEl = document.createElement('div');
                    blessingEl.className = 'blessing blessing-enter';
                    blessingEl.textContent = randomBlessing;
                    
                    // ä¸´æ—¶æ·»åŠ åˆ°DOMä»¥è·å–å°ºå¯¸
                    document.body.appendChild(blessingEl);
                    
                    // å°è¯•æ‰¾åˆ°ä¸é‡å çš„ä½ç½®
                    let attempts = 0;
                    let positionFound = false;
                    
                    while (attempts < 50 && !positionFound) {
                        // éšæœºä½ç½®ï¼Œè€ƒè™‘å…ƒç´ å°ºå¯¸
                        const maxX = window.innerWidth - blessingEl.offsetWidth;
                        const maxY = window.innerHeight - blessingEl.offsetHeight;
                        const posX = Math.floor(Math.random() * maxX);
                        const posY = Math.floor(Math.random() * maxY);
                        
                        // è®¾ç½®ä½ç½®
                        blessingEl.style.left = `${posX}px`;
                        blessingEl.style.top = `${posY}px`;
                        
                        // è·å–å…ƒç´ çŸ©å½¢
                        const rect = {
                            left: posX,
                            top: posY,
                            right: posX + blessingEl.offsetWidth,
                            bottom: posY + blessingEl.offsetHeight
                        };
                        
                        // æ£€æŸ¥æ˜¯å¦ä¸ç°æœ‰å…ƒç´ é‡å 
                        if (!isOverlapping(rect, existingRects)) {
                            existingRects.push(rect);
                            positionFound = true;
                        }
                        
                        attempts++;
                    }
                    
                    // å¦‚æœæ— æ³•æ‰¾åˆ°ä¸é‡å çš„ä½ç½®ï¼Œä½¿ç”¨éšæœºä½ç½®
                    if (!positionFound) {
                        const maxX = window.innerWidth - blessingEl.offsetWidth;
                        const maxY = window.innerHeight - blessingEl.offsetHeight;
                        const posX = Math.floor(Math.random() * maxX);
                        const posY = Math.floor(Math.random() * maxY);
                        
                        blessingEl.style.left = `${posX}px`;
                        blessingEl.style.top = `${posY}px`;
                        
                        existingRects.push({
                            left: posX,
                            top: posY,
                            right: posX + blessingEl.offsetWidth,
                            bottom: posY + blessingEl.offsetHeight
                        });
                    }
                    
                    // éšæœºé¢œè‰²
                    const colors = [
                        '#FFD700', '#FF69B4', '#00FFFF', '#FF6347', 
                        '#7CFC00', '#9370DB', '#FFA500', '#FF1493', 
                        '#00FA9A', '#8A2BE2', '#FF4500', '#ADFF2F'
                    ];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    blessingEl.style.color = randomColor;
                    blessingEl.style.textShadow = `0 0 15px ${randomColor}80`;
                    
                    // éšæœºæ—‹è½¬è§’åº¦
                    const randomRotation = Math.floor(Math.random() * 20) - 10; // -10åˆ°10åº¦
                    blessingEl.style.transform = `rotate(${randomRotation}deg)`;
                    
                    // å¦‚æœä½ç½®è¢«å¼ºåˆ¶è®¾ç½®ï¼Œé‡æ–°æ·»åŠ åˆ°DOM
                    if (blessingEl.parentNode) {
                        // ä¿æŒåœ¨DOMä¸­
                    } else {
                        document.body.appendChild(blessingEl);
                    }
                    
                    // æ·»åŠ åˆ°å½“å‰ç»„
                    currentGroup.push(blessingEl);
                    
                    // 35ç§’åå¼€å§‹æ·¡å‡º
                    setTimeout(() => {
                        blessingEl.classList.remove('blessing-enter');
                        blessingEl.classList.add('blessing-exit');
                        
                        // 1ç§’åç§»é™¤å…ƒç´ 
                        setTimeout(() => {
                            if (blessingEl.parentNode) {
                                blessingEl.parentNode.removeChild(blessingEl);
                            }
                        }, 1000);
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç»„æœ€åä¸€ä¸ªå…ƒç´ 
                        if (currentGroup.every(el => !el.parentNode)) {
                            // å½“å‰ç»„å…¨éƒ¨æ¶ˆå¤±åï¼Œç­‰å¾…2ç§’è¡¥å……ä¸‹ä¸€ç»„
                            if (groupIndex < 2) { // åªæœ‰å‰2ç»„éœ€è¦è¡¥å……ä¸‹ä¸€ç»„
                                setTimeout(() => {
                                    showNextGroup(groupIndex + 1, itemsPerGroup);
                                }, 2000);
                            }
                        }
                    }, 35000); // 35ç§’åœç•™
                    
                    // æ·»åŠ ç§»åŠ¨åŠ¨ç”»ï¼ˆæ— ç¢°æ’ï¼‰
                    startMovingAnimation(blessingEl);
                }, i * 150); // ç»„å†…é”™å¼€æ˜¾ç¤ºæ—¶é—´
            }
        }

        // å€’è®¡æ—¶åŠŸèƒ½
        function startCountdown() {
            const countdownEl = getElement('countdown');
            const yearDisplay = getElement('yearDisplay');
            const messageEl = getElement('message');
            const toastArea = getElement('toast-area');
            const controls = getElement('controls');
            
            if (!countdownEl) return;
            
            let count = 10;
            countdownEl.textContent = count;
            countdownEl.classList.remove('countdown-pulse');
            void countdownEl.offsetWidth; // è§¦å‘é‡æ’
            countdownEl.classList.add('countdown-pulse');
            
            // ç¡®ä¿äº¤äº’å…ƒç´ åœ¨å€’è®¡æ—¶æœŸé—´éšè—
            if (toastArea) toastArea.classList.remove('show');
            if (controls) controls.classList.remove('show');

            const timer = setInterval(() => {
                count--;
                
                if (count > 0) {
                    countdownEl.textContent = count;
                    countdownEl.classList.remove('countdown-pulse');
                    void countdownEl.offsetWidth; // è§¦å‘é‡æ’
                    countdownEl.classList.add('countdown-pulse');
                } else {
                    clearInterval(timer);
                    countdownEl.style.display = 'none';
                    
                    if (yearDisplay) {
                        yearDisplay.classList.add('show');
                    }
                    
                    // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
                    setTimeout(() => {
                        const cheerSound = getElement('cheerSound');
                        if (cheerSound) {
                            cheerSound.currentTime = 0;
                            cheerSound.play().catch(e => console.log('Audio play error:', e));
                        }
                    }, 500);
                    
                    // æ˜¾ç¤ºç¥ç¦ä¿¡æ¯å’Œäº¤äº’å…ƒç´ 
                    setTimeout(() => {
                        if (messageEl) {
                            messageEl.classList.add('show');
                        }
                        if (toastArea) {
                            toastArea.classList.add('show');
                        }
                        if (controls) {
                            controls.classList.add('show');
                        }
                        
                        // å¼€å§‹è‡ªåŠ¨å‘å°„çƒŸèŠ±
                        autoLaunchFireworks();
                    }, 1000);
                }
            }, 1000);
        }

        // è‡ªåŠ¨å‘å°„çƒŸèŠ±
        function autoLaunchFireworks() {
            setInterval(() => {
                const yearDisplay = getElement('yearDisplay');
                if (yearDisplay && yearDisplay.classList.contains('show')) {
                    if (fireworks && typeof fireworks.launch === 'function') {
                        fireworks.launch();
                    }
                }
            }, 800);
        }

        // ç¢°æ¯åŠ¨ç”»
        function showToast() {
            const toastAnim = getElement('toastAnim');
            if (toastAnim) {
                toastAnim.textContent = 'ğŸ¥‚';
                toastAnim.style.opacity = '1';
                toastAnim.style.top = '-50px';
                
                // åŠ¨ç”»
                let pos = -50;
                const moveAnim = setInterval(() => {
                    pos += 5;
                    toastAnim.style.top = pos + 'px';
                    toastAnim.style.opacity = (1 - pos / 200);
                    
                    if (pos > 100) {
                        clearInterval(moveAnim);
                        toastAnim.style.opacity = '0';
                    }
                }, 30);
            }
            
            // æ’­æ”¾ç¢°æ¯éŸ³æ•ˆ
            const clinkSound = getElement('clinkSound');
            if (clinkSound) {
                clinkSound.currentTime = 0;
                clinkSound.play().catch(e => console.log('Audio play error:', e));
            }
            
            // æ˜¾ç¤ºéšæœºç¥ç¦è¯­
            showRandomBlessings();
        }

        // éŸ³ä¹æ§åˆ¶åŠŸèƒ½
        function initMusicControls() {
            const bgMusic = getElement('bgMusic');
            const musicPlayBtn = getElement('musicPlayBtn');
            const musicPauseBtn = getElement('musicPauseBtn');
            const musicMuteBtn = getElement('musicMuteBtn');
            
            if (!bgMusic) return;
            
            // æ’­æ”¾éŸ³ä¹
            if (musicPlayBtn) {
                musicPlayBtn.addEventListener('click', () => {
                    bgMusic.play().catch(e => console.log('Play error:', e));
                    musicPlayBtn.classList.add('active');
                    musicPauseBtn.classList.remove('active');
                });
            }
            
            // æš‚åœéŸ³ä¹
            if (musicPauseBtn) {
                musicPauseBtn.addEventListener('click', () => {
                    bgMusic.pause();
                    musicPauseBtn.classList.add('active');
                    musicPlayBtn.classList.remove('active');
                });
            }
            
            // é™éŸ³åˆ‡æ¢
            if (musicMuteBtn) {
                let muted = false;
                musicMuteBtn.addEventListener('click', () => {
                    muted = !muted;
                    bgMusic.muted = muted;
                    musicMuteBtn.textContent = muted ? 'ğŸ”‡' : 'ğŸ”Š';
                });
            }
            
            // éŸ³ä¹ç»“æŸæ—¶è‡ªåŠ¨æ’­æ”¾
            bgMusic.addEventListener('ended', () => {
                bgMusic.currentTime = 0;
                bgMusic.play().catch(e => console.log('Play error:', e));
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            // å¼€å§‹å€’è®¡æ—¶
            startCountdown();

            // åˆå§‹åŒ–éŸ³ä¹æ§åˆ¶
            initMusicControls();

            // ç¢°æ¯æŒ‰é’®äº‹ä»¶ï¼ˆäº‹ä»¶å§”æ‰˜ï¼Œç¡®ä¿å…ƒç´ å­˜åœ¨æ—¶å†ç»‘å®šï¼‰
            document.addEventListener('click', function(e) {
                if (e.target.id === 'toastBtn' || e.target.classList.contains('glass')) {
                    showToast();
                }
                
                if (e.target.id === 'restartBtn') {
                    const countdownEl = getElement('countdown');
                    const yearDisplay = getElement('yearDisplay');
                    const messageEl = getElement('message');
                    const toastArea = getElement('toast-area');
                    const controls = getElement('controls');
                    
                    // ç§»é™¤èƒŒæ™¯æ–‡å­—å’Œæ‰€æœ‰ç¥ç¦è¯­
                    document.querySelectorAll('.background-text, .blessing').forEach(el => el.remove());
                    
                    if (countdownEl) {
                        countdownEl.style.display = 'block';
                        countdownEl.textContent = '10';
                        countdownEl.classList.remove('countdown-pulse');
                        void countdownEl.offsetWidth; // è§¦å‘é‡æ’
                        countdownEl.classList.add('countdown-pulse');
                    }
                    if (yearDisplay) yearDisplay.classList.remove('show');
                    if (messageEl) messageEl.classList.remove('show');
                    if (toastArea) toastArea.classList.remove('show');
                    if (controls) controls.classList.remove('show');
                    startCountdown();
                }
            });

            // é˜²æ­¢éŸ³é¢‘è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢
            document.body.addEventListener('click', function() {
                const clinkSound = getElement('clinkSound');
                const cheerSound = getElement('cheerSound');
                const bgMusic = getElement('bgMusic');
                
                [clinkSound, cheerSound, bgMusic].forEach(audio => {
                    if (audio) {
                        audio.play().then(() => audio.pause()).catch(e => console.log('Auto play prevented:', e));
                    }
                });
            }, { once: true });
        });
    </script>
</body>
</html>



